import{cloneElement as t,Component as e,h as n}from"./preact.js";var r={};function o(t,e){for(var n in e)t[n]=e[n];return t}function i(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:t.index-e.index}function u(t,e){return t.index=e,t.rank=function(t){return t.attributes.default?0:(e=t.attributes.path,a(e).map(p).join(""));var e}(t),t.attributes}function a(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function p(t){return":"==t.charAt(0)?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var c=null,f=[],l=[],s={};function h(){var t;return""+((t=c&&c.location?c.location:c&&c.getCurrentLocation?c.getCurrentLocation():"undefined"!=typeof location?location:s).pathname||"")+(t.search||"")}function d(t,e){return void 0===e&&(e=!1),"string"!=typeof t&&t.url&&(e=t.replace,t=t.url),function(t){for(var e=f.length;e--;)if(f[e].canRoute(t))return!0;return!1}(t)&&function(t,e){void 0===e&&(e="push"),c&&c[e]?c[e](t):"undefined"!=typeof history&&history[e+"State"]&&history[e+"State"](null,null,t)}(t,e?"replace":"push"),g(t)}function g(t){for(var e=!1,n=0;n<f.length;n++)!0===f[n].routeTo(t)&&(e=!0);for(var r=l.length;r--;)l[r](t);return e}function m(t){if(t&&t.getAttribute){var e=t.getAttribute("href"),n=t.getAttribute("target");if(e&&e.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return d(e)}}function v(t){if(0==t.button)return m(t.currentTarget||t.target||this),y(t)}function y(t){return t&&(t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault()),!1}function b(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||0!==t.button)){var e,n=t.target;do{if("A"===String(n.nodeName).toUpperCase()&&n.getAttribute("href")&&(null!=(e=n).__preactattr_||"undefined"!=typeof Symbol&&null!=e[Symbol.for("preactattr")])){if(n.hasAttribute("native"))return;if(m(n))return y(t)}}while(n=n.parentNode)}}var C=!1;var U=function(e){function n(t){e.call(this,t),t.history&&(c=t.history),this.state={url:t.url||h()},C||("function"==typeof addEventListener&&(c||addEventListener("popstate",(function(){g(h())})),addEventListener("click",b)),C=!0)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.shouldComponentUpdate=function(t){return!0!==t.static||(t.url!==this.props.url||t.onChange!==this.props.onChange)},n.prototype.canRoute=function(t){return this.getMatchingChildren(this.props.children,t,!1).length>0},n.prototype.routeTo=function(t){return this._didRoute=!1,this.setState({url:t}),this.updating?this.canRoute(t):(this.forceUpdate(),this._didRoute)},n.prototype.componentWillMount=function(){f.push(this),this.updating=!0},n.prototype.componentDidMount=function(){var t=this;c&&(this.unlisten=c.listen((function(e){t.routeTo(""+(e.pathname||"")+(e.search||""))}))),this.updating=!1},n.prototype.componentWillUnmount=function(){"function"==typeof this.unlisten&&this.unlisten(),f.splice(f.indexOf(this),1)},n.prototype.componentWillUpdate=function(){this.updating=!0},n.prototype.componentDidUpdate=function(){this.updating=!1},n.prototype.getMatchingChildren=function(e,n,p){return e.filter(u).sort(i).map((function(e){var i=function(t,e,n){var o,i=/(?:\?([^#]*))?(#.*)?$/,u=t.match(i),p={};if(u&&u[1])for(var c=u[1].split("&"),f=0;f<c.length;f++){var l=c[f].split("=");p[decodeURIComponent(l[0])]=decodeURIComponent(l.slice(1).join("="))}t=a(t.replace(i,"")),e=a(e||"");for(var s=Math.max(t.length,e.length),h=0;h<s;h++)if(e[h]&&":"===e[h].charAt(0)){var d=e[h].replace(/(^\:|[+*?]+$)/g,""),g=(e[h].match(/[+*?]+$/)||r)[0]||"",m=~g.indexOf("+"),v=~g.indexOf("*"),y=t[h]||"";if(!y&&!v&&(g.indexOf("?")<0||m)){o=!1;break}if(p[d]=decodeURIComponent(y),m||v){p[d]=t.slice(h).map(decodeURIComponent).join("/");break}}else if(e[h]!==t[h]){o=!1;break}return(!0===n.default||!1!==o)&&p}(n,e.attributes.path,e.attributes);if(i){if(!1!==p){var u={url:n,matches:i};return o(u,i),delete u.ref,delete u.key,t(e,u)}return e}})).filter(Boolean)},n.prototype.render=function(t,e){var n=t.children,r=t.onChange,o=e.url,i=this.getMatchingChildren(n,o,!0),u=i[0]||null;this._didRoute=!!u;var a=this.previousUrl;return o!==a&&(this.previousUrl=o,"function"==typeof r&&r({router:this,url:o,previous:a,active:i,current:u})),u},n}(e),k=function(t){return n("a",o({onClick:v},t))},R=function(t){return n(t.component,t)};U.subscribers=l,U.getCurrentUrl=h,U.route=d,U.Router=U,U.Route=R,U.Link=k;export default U;export{k as Link,R as Route,U as Router,h as getCurrentUrl,d as route,l as subscribers};
//# sourceMappingURL=preact-router.js.map
